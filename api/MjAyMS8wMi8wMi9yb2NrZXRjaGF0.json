{"title":"Rocket.Chat for Docker","date":"2021-02-02T08:38:18.000Z","date_formatted":{"ll":"Feb 2, 2021","L":"02/02/2021","MM-DD":"02-02"},"link":"2021/02/02/rocketchat","updated":"2021-02-02T08:42:05.175Z","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/assets/css/APlayer.min.css\"><script src=\"/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"/assets/js/Meting.min.js\"></script><h1 id=\"安装mongodb\">安装MongoDB<a title=\"#安装mongodb\" href=\"#安装mongodb\"></a></h1>\n<h2 id=\"创建mongodb数据\">创建MongoDB数据<a title=\"#创建mongodb数据\" href=\"#创建mongodb数据\"></a></h2>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p &#x2F;mnt&#x2F;user&#x2F;appdata&#x2F;mongodb</span><br><span class=\"line\"></span><br><span class=\"line\">cd &#x2F;mnt&#x2F;user&#x2F;appdata&#x2F;mongodb</span><br><span class=\"line\"></span><br><span class=\"line\">nano mongod.conf</span><br></pre></td></tr></table></figure>\n<p>把下面的内容复制进<code>mongod.conf</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mongod.conf</span><br><span class=\"line\"></span><br><span class=\"line\"># for documentation of all options, see:</span><br><span class=\"line\">#   http:&#x2F;&#x2F;docs.mongodb.org&#x2F;manual&#x2F;reference&#x2F;configuration-options&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\"># Where and how to store data.</span><br><span class=\"line\">storage:</span><br><span class=\"line\">  dbPath: &#x2F;data&#x2F;db</span><br><span class=\"line\">  journal:</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">#  engine:</span><br><span class=\"line\">#  mmapv1:</span><br><span class=\"line\">#  wiredTiger:</span><br><span class=\"line\"></span><br><span class=\"line\"># network interfaces</span><br><span class=\"line\">net:</span><br><span class=\"line\">  port: 27017</span><br><span class=\"line\">  bindIp: 127.0.0.1</span><br><span class=\"line\"></span><br><span class=\"line\"># how the process runs</span><br><span class=\"line\">processManagement:</span><br><span class=\"line\">  timeZoneInfo: &#x2F;usr&#x2F;share&#x2F;zoneinfo</span><br><span class=\"line\"></span><br><span class=\"line\">#security: </span><br><span class=\"line\">#  authorization: &quot;enabled&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">#operationProfiling:</span><br><span class=\"line\"></span><br><span class=\"line\">replication:</span><br><span class=\"line\">  replSetName: &quot;rs01&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">#sharding:</span><br><span class=\"line\"></span><br><span class=\"line\">## Enterprise-Only Options:</span><br><span class=\"line\"></span><br><span class=\"line\">#auditLog:</span><br><span class=\"line\"></span><br><span class=\"line\">#snmp:</span><br></pre></td></tr></table></figure>\n<p>依次按<code>ctrl+o</code>、<code>enter</code>、<code>ctrl+x</code>保存并退出</p>\n<h2 id=\"运行mongodb的docker容器\">运行MongoDB的Docker容器<a title=\"#运行mongodb的docker容器\" href=\"#运行mongodb的docker容器\"></a></h2>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run \\</span><br><span class=\"line\">-itd \\</span><br><span class=\"line\">-e PGID&#x3D;1000 \\</span><br><span class=\"line\">-e PUID&#x3D;1000 \\</span><br><span class=\"line\">--name&#x3D;&#39;MongoDB&#39; \\</span><br><span class=\"line\">--net&#x3D;&#39;br0&#39; \\ </span><br><span class=\"line\">--ip&#x3D;192.168.2.3 \\  #改成自己的内网IP 固定MongoDB的IP地址</span><br><span class=\"line\">-e TZ&#x3D;&quot;Asia&#x2F;Shanghai&quot; \\</span><br><span class=\"line\">-p &#39;27017:27017&#x2F;tcp&#39; \\</span><br><span class=\"line\">-v &#39;&#x2F;mnt&#x2F;user&#x2F;appdata&#x2F;mongodb&#x2F;&#39;:&#39;&#x2F;data&#x2F;db&#39;:&#39;rw&#39; \\</span><br><span class=\"line\">--hostname mongodatabase &#39;mongo&#39; \\</span><br><span class=\"line\">-f &#x2F;data&#x2F;db&#x2F;mongod.conf</span><br></pre></td></tr></table></figure>\n<h2 id=\"创建mongodb数据库\">创建MongoDB数据库<a title=\"#创建mongodb数据库\" href=\"#创建mongodb数据库\"></a></h2>\n<p>输入</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it MongoDB bash</span><br></pre></td></tr></table></figure>\n<p>进入MongoDB容器</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongo</span><br><span class=\"line\">rs.initiate()</span><br><span class=\"line\"></span><br><span class=\"line\">use admin</span><br><span class=\"line\">db.createUser(&#123;user: &quot;root&quot;,pwd: &quot;rocketchat&quot;,roles: [&#123; role: &quot;root&quot;, db: &quot;admin&quot;&#125;]&#125;)</span><br><span class=\"line\">db.createUser(&#123;user: &quot;rocketchat&quot;,pwd: &quot;rocketchat&quot;,roles: [&#123;role: &quot;readWrite&quot;, db: &quot;local&quot; &#125;]&#125;)</span><br><span class=\"line\">use rocketchat</span><br><span class=\"line\">db.createUser(&#123;user: &quot;rocketchat&quot;,pwd: &quot;rocketchat&quot;,roles: [&#123; role: &quot;dbOwner&quot;,db: &quot;rocketchat&quot; &#125;]&#125;)</span><br></pre></td></tr></table></figure>\n<p>输入<code>docker stop MongoDB</code> 停止容器运行</p>\n<p>回到 <code>/mnt/user/appdata/mongodb</code>文件夹下<br>\n输入<code>nano mongod.conf</code>找到</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#security: </span><br><span class=\"line\">#   authorization: &quot;enabled&quot; </span><br></pre></td></tr></table></figure>\n<p>删除这两行开头的<code>#</code></p>\n<p>依次按<code>ctrl+o</code>、<code>enter</code>、<code>ctrl+x</code>保存并退出</p>\n<p>输入<code>docker start MongoDB</code> 运行容器</p>\n<h1 id=\"安装rocket.chat\">安装Rocket.Chat<a title=\"#安装rocket.chat\" href=\"#安装rocket.chat\"></a></h1>\n<h2 id=\"运行rocket.chat容器\">运行Rocket.Chat容器<a title=\"#运行rocket.chat容器\" href=\"#运行rocket.chat容器\"></a></h2>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run \\</span><br><span class=\"line\">-itd \\</span><br><span class=\"line\">-e PGID&#x3D;1000 \\</span><br><span class=\"line\">-e PUID&#x3D;1000 \\</span><br><span class=\"line\">--name&#x3D;&#39;Rocket.Chat&#39; \\</span><br><span class=\"line\">--net&#x3D;&#39;br0&#39; \\</span><br><span class=\"line\">--ip&#x3D;192.168.2.4 \\ #改为自己的内网IP</span><br><span class=\"line\">-e TZ&#x3D;&quot;Asia&#x2F;Shanghai&quot; \\</span><br><span class=\"line\">-e &#39;MONGO_URL&#39;&#x3D;&#39;mongodb:&#x2F;&#x2F;rocketchat:rocketchat@192.168.2.3:27017&#x2F;rocketchat&#39; \\ #改为自己的MongoDB的IP地址</span><br><span class=\"line\">-e &#39;ROOT_URL&#39;&#x3D;&#39;http:&#x2F;&#x2F;192.168.2.5&#39; \\ #改为自己的内网IP</span><br><span class=\"line\">-e &#39;MONGO_OPLOG_URL&#39;&#x3D;&#39;mongodb:&#x2F;&#x2F;rocketchat:rocketchat@192.168.2.3:27017&#x2F;local?authSource&#x3D;admin&#39; \\  #改为自己的MongoDB的IP地址</span><br><span class=\"line\">-p &#39;3000:3000&#x2F;tcp&#39; \\</span><br><span class=\"line\">-v &#39;&#x2F;mnt&#x2F;user&#x2F;appdata&#x2F;rocketchat&#39;:&#39;&#x2F;app&#x2F;uploads&#39;:&#39;rw&#39; &#39;library&#x2F;rocket.chat&#39;</span><br></pre></td></tr></table></figure>\n<p>输入<code>docker logs -f Rocket.Chat</code> 查看容器运行情况</p>\n<p>出现下面的信息 就说明已经成功运行了</p>\n<p>浏览器输入<code>IP:3000</code>就可以进入后台配置了</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">➔ System ➔ startup</span><br><span class=\"line\">➔ +-------------------------------------------+</span><br><span class=\"line\">➔ |               SERVER RUNNING              |</span><br><span class=\"line\">➔ +-------------------------------------------+</span><br><span class=\"line\">➔ |                                           |</span><br><span class=\"line\">➔ |  Rocket.Chat Version: 3.10.5              |</span><br><span class=\"line\">➔ |       NodeJS Version: 12.18.4 - x64       |</span><br><span class=\"line\">➔ |      MongoDB Version: 4.4.3               |</span><br><span class=\"line\">➔ |       MongoDB Engine: unknown             |</span><br><span class=\"line\">➔ |             Platform: linux               |</span><br><span class=\"line\">➔ |         Process Port: 3000                |</span><br><span class=\"line\">➔ |             Site URL: http:&#x2F;&#x2F;192.168.2.5  |</span><br><span class=\"line\">➔ |     ReplicaSet OpLog: Enabled             |</span><br><span class=\"line\">➔ |          Commit Hash: 1e36f41838          |</span><br><span class=\"line\">➔ |        Commit Branch: HEAD                |</span><br><span class=\"line\">➔ |                                           |</span><br><span class=\"line\">➔ +-------------------------------------------+</span><br></pre></td></tr></table></figure>","next":{"title":"FileRun+NextCloud实现图床和备份","link":"2021/01/31/imagebackup"},"plink":"https://0x01x0.ml/2021/02/02/rocketchat/","toc":[{"id":"安装mongodb","title":"安装MongoDB","index":"1","children":[{"id":"创建mongodb数据","title":"创建MongoDB数据","index":"1.1"},{"id":"运行mongodb的docker容器","title":"运行MongoDB的Docker容器","index":"1.2"},{"id":"创建mongodb数据库","title":"创建MongoDB数据库","index":"1.3"}]},{"id":"安装rocket.chat","title":"安装Rocket.Chat","index":"2","children":[{"id":"运行rocket.chat容器","title":"运行Rocket.Chat容器","index":"2.1"}]}]}